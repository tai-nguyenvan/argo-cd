apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: postgresql-database
  namespace: argocd
spec:
  project: default
  source:
    chart: postgresql
    repository: https://charts.bitnami.com/bitnami
    targetRevision: 16.7.15
    helm:
      valuesObject:
        auth:
          enablePostgresUser: true
          # --- SECRETS MANAGED EXTERNALLY ---
          # Use your secrets manager integration (e.g., External Secrets Operator)
          # to reference actual secrets here instead of hardcoding values.
          # postgresPassword:
          # username:
          # password:
          # database:
          # ----------------------------------
          # NOTE: The actual implementation depends on your chosen secret management tool.
        # ... other fields remain the same ...
        primary:
          persistence:
            enabled: true
            storageClass: "standard"
            accessModes:
              - ReadWriteOnce
            size: 8Gi
        # ... rest of the spec ...
  destination:
    server: 'https://kubernetes.default.svc'
    namespace: data-stores # Changed from 'default' to a specific namespace
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
